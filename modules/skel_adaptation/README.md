# Skeleton Adaptation

Contains scripts to handle skeleton annotation convertions between NTU RGB+D 60/120 and HumanML3D

## Details
Standard formats
* NTU $\rightarrow$ Kinect format (25 joints).
* HumanML3D $\rightarrow$ SMPL format (without hand joints, 22 total).

Some custom formats employed by us:
* Kinect-reduced $\rightarrow$ Kinect format with no hand information (19 joints)


<div align="center">

| NTU Skeleton | SMPL Skeleton |
|:------------:|:-------------:|
| <img src="../../media/ntu_skele.svg" width="40%"> | <img src="../../media/smpl_skele.svg" width="40%"> |

</div>

## Usage

<details>
  <summary><b>Forward</b></summary>

Maps NTU 60/120 data (PySkl format) from Kinect to SMPL format statically
* ***TODO: input data is assumed to be original PySkl data***

```bash
python3 skel_mapping.py \
    --input-data ../../data/NTU60/ntu60_3danno.pkl \
    --mode=forward
```
</details>

<details>
  <summary><b>Bacward</b></summary>

Maps samples generated by MDM (SMPL-22) into NTU compatible format (Kinekt-reduced-19):

```bash
python3 skel_mapping.py \
  --input-data ../../external/motion-diffusion-model/save/humanml_enc_512_50steps/samples_humanml_enc_512_50steps_000750000_seed10 \
  --mode=backward
```

</details>

<details>
  <summary><b>Dataset Formatting</b></summary>

This modality allow to process an input .pkl file being the original NTU 60/120 dataset and applies transformations to it, such as
* sub-sampling from $30 \rightarrow 20$ fps
* dropping some joints (hands) reducing the count of joints $25 \rightarrow 19$
* ...

```bash
python3 skel_mapping.py \
  --input-data ../../data/NTU60/ntu60_3danno.pkl \
  --mode=format_dataset
```
</details>

## Visualization

This function allows to visualize our Forwar-Backward mappings. This is not functional to the repository, but helps understanding the correctness of our procedure and debugging.

First of all, execute the following to obtain a backward mapping directly applied on `out/forw` (usefull for debugging especially)

```bash
python3 skel_mapping.py \
  --input-data out/forw \
  --mode=toy_backward
```

You can inspect both format for some random action class one next to the other using the following script
```bash
python3 viz.py \
    --orig-data-pkl ../../data/NTU60/ntu60_3danno.pkl \
    --forward-data-root out/forw \
    --backward-data-pkl out/back/ntu60_3danno_back.pkl \
    --class-idx 19
```
